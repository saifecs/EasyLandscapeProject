<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Easy Landscape Services Ltd. - Get A Quote</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <link href="img/favicon.ico" rel="icon">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;500&display=swap" rel="stylesheet">  

    <!-- Icons / Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">

    <!-- Leaflet + Draw + Geocoder CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

<style>
#yardMap { height: 520px; border-radius: 12px; overflow: hidden; }
.badge-mode {padding:.45rem .65rem;border-radius:8px;margin-right:.5rem;font-weight:600;user-select:none;}
.badge-include {background:#e8f5e9;border:1px solid #348E38;color:#0F4229;}
.badge-exclude {background:#fff2f2;border:1px solid #c94141;color:#8a1d1d;cursor:pointer;}
.yard-toolbar{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;}
.yard-pill{padding:.4rem .7rem;border-radius:999px;background:#0f4229;color:#fff;font-weight:600;}
.leaflet-bar a {font-size:16px !important;}
</style>

</head>
<body>

<!-- Spinner -->
<div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
    <div class="spinner-border text-primary" style="width:3rem;height:3rem;"></div>
</div>

<!-- Topbar -->
<div class="container-fluid bg-dark text-light px-0 py-2 d-none d-lg-block">
    <div class="row gx-0">
        <div class="col-lg-7 px-5 text-start">
            <span class="fa fa-phone-alt me-2"></span> +1 (403) 614-8476 &nbsp;&nbsp;
            <span class="far fa-envelope me-2"></span> myoussef@easylandscape.ca
        </div>
        <div class="col-lg-5 px-5 text-end">
            <span>Follow Us:</span>
            <a class="btn btn-link text-light" href="#"><i class="fab fa-facebook-f"></i></a>
            <a class="btn btn-link text-light" href="#"><i class="fab fa-instagram"></i></a>
        </div>
    </div>
</div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0">
    <a href="index.html" class="navbar-brand px-4">
        <h1 class="m-0">Easy Landscape</h1>
    </a>
    <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <div class="navbar-nav ms-auto p-4 p-lg-0">
            <a href="index.html" class="nav-item nav-link">Home</a>
            <a href="landscape.html" class="nav-item nav-link">Landscape</a>
            <a href="construction.html" class="nav-item nav-link">Construction</a>
            <a href="snow.html" class="nav-item nav-link">Snow</a>
            <a href="christmas-lights.html" class="nav-item nav-link">Christmas Lights</a>
            <a href="projects-gallery.html" class="nav-item nav-link">Projects Gallery</a>
            <a href="about.html" class="nav-item nav-link">About Us</a>
        </div>
        <a href="quote.html" class="btn btn-primary py-4 px-lg-4 d-none d-lg-block">Get A Quote</a>
    </div>
</nav>

<!-- Header -->
<div class="container-fluid page-header py-5 mb-5 text-white">
    <div class="container py-5">
        <h1 class="display-3">Get A Free Quote</h1>
    </div>
</div>

<!-- Quote Form -->
<div class="container quote bg-white p-5 rounded shadow">
    <h1 class="text-center mb-5">Get A Free Quote</h1>

    <form id="quoteForm">

        <div class="row g-3 mb-4">
            <div class="col-sm-6"><input class="form-control" id="quoteName" name="quoteName" placeholder="Name" required></div>
            <div class="col-sm-6"><input class="form-control" id="quoteEmail" name="quoteEmail" placeholder="Email" required type="email"></div>
            <div class="col-sm-6"><input class="form-control" id="quotePhone" name="quotePhone" placeholder="Phone"></div>
            <div class="col-sm-6">
                <select class="form-control" id="quoteService" name="quoteService" required>
                    <option value="">Select Service</option>
                    <option>Landscaping</option>
                    <option>Lawn Maintenance</option>
                    <option>Spring Clean-Up</option>
                    <option>Snow Removal</option>
                </select>
            </div>
        </div>

        <h5>Measure Your Yard (Optional)</h5>
        <p class="text-muted">Search address → outline lawn → exclude house → area auto-fills</p>

        <div class="yard-toolbar mb-2">
            <span id="modeInclude" class="badge-mode badge-include">Drawing: Lawn (Include)</span>
            <span id="modeExclude" class="badge-mode badge-exclude">Switch to Exclusion Mode</span>
            <button id="clearAll" type="button" class="btn btn-sm btn-outline-secondary">Clear</button>
            <span id="areaPill" class="yard-pill ms-auto">Area: 0 ft² (0 m²)</span>
        </div>

        <div id="yardMap" class="mb-3"></div>

        <!-- Hidden fields submitted -->
        <input id="yardAreaSqft" name="yardAreaSqft" type="hidden">
        <input id="yardAreaSqm"  name="yardAreaSqm" type="hidden">
        <input id="mapLat" name="mapLat" type="hidden">
        <input id="mapLng" name="mapLng" type="hidden">

        <textarea class="form-control mb-4" id="quoteMessage" name="quoteMessage" placeholder="Message" rows="4"></textarea>

        <div id="quoteMessageAlert" class="alert d-none mb-3"></div>

        <button type="submit" class="btn btn-primary w-100 py-3" id="quoteSubmitBtn">
            <span id="quoteSubmitText">Submit Quote</span>
            <span id="quoteSubmitSpinner" class="spinner-border spinner-border-sm d-none ms-2" role="status"></span>
        </button>

    </form>
</div>


<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="main.js"></script>

<!-- Backend Integration -->
<script type="text/javascript">
    // Backend API URL - Update this to your production URL when deploying
    const API_BASE_URL = 'http://localhost:3000';
    
    // Handle quote form submission
    document.getElementById('quoteForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const submitBtn = document.getElementById('quoteSubmitBtn');
        const submitText = document.getElementById('quoteSubmitText');
        const submitSpinner = document.getElementById('quoteSubmitSpinner');
        const alertDiv = document.getElementById('quoteMessageAlert');
        
        // Show loading state
        submitBtn.disabled = true;
        submitText.textContent = 'Sending...';
        submitSpinner.classList.remove('d-none');
        alertDiv.classList.add('d-none');
        
        // Prepare form data
        const formData = {
            formType: 'landscape_quote',
            name: document.getElementById('quoteName').value,
            email: document.getElementById('quoteEmail').value,
            phone: document.getElementById('quotePhone').value || null,
            service: document.getElementById('quoteService').value,
            message: document.getElementById('quoteMessage').value || null,
            yardAreaSqft: document.getElementById('yardAreaSqft').value || null,
            yardAreaSqm: document.getElementById('yardAreaSqm').value || null,
            mapLat: document.getElementById('mapLat').value || null,
            mapLng: document.getElementById('mapLng').value || null,
            timestamp: new Date().toISOString()
        };
        
        try {
            // Send to backend API
            const response = await fetch(`${API_BASE_URL}/api/quotes`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            if (response.ok) {
                // Success
                alertDiv.className = 'alert alert-success';
                alertDiv.innerHTML = '<strong>Success!</strong> Your quote request has been sent. We\'ll get back to you soon!';
                alertDiv.classList.remove('d-none');
                
                // Reset form
                document.getElementById('quoteForm').reset();
                document.getElementById('areaPill').textContent = 'Area: 0 ft² (0 m²)';
                
                // Reset button
                submitBtn.disabled = false;
                submitText.textContent = 'Submit Quote';
                submitSpinner.classList.add('d-none');
            } else {
                throw new Error(result.message || 'Server error');
            }
        } catch (error) {
            // Error
            console.error('Error submitting form:', error);
            alertDiv.className = 'alert alert-danger';
            alertDiv.innerHTML = '<strong>Error!</strong> There was a problem sending your request. Please try again or contact us directly at +1 (403) 614-8476.';
            alertDiv.classList.remove('d-none');
            
            // Reset button
            submitBtn.disabled = false;
            submitText.textContent = 'Submit Quote';
            submitSpinner.classList.add('d-none');
        }
    });
</script>

<!-- Leaflet + plugins + Turf -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<script>
(function(){

var map = L.map('yardMap').setView([51.0447, -114.0719], 16);

// High-Res ESRI satellite + labels
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')
  .addTo(map);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',{opacity:.8})
  .addTo(map);

// Address Search
L.Control.geocoder({defaultMarkGeocode:false,placeholder:"Search address…"})
.on('markgeocode', e=>{
    var c=e.geocode.center;
    map.setView(c,19);
    document.getElementById("mapLat").value=c.lat;
    document.getElementById("mapLng").value=c.lng;
})
.addTo(map);

var include = new L.FeatureGroup().addTo(map);
var exclude = new L.FeatureGroup().addTo(map);

var drawControl = new L.Control.Draw({
  draw:{
    polygon:{allowIntersection:false,showArea:true,shapeOptions:{color:"#348E38",fillOpacity:.25}},
    rectangle:false,polyline:false,marker:false,circle:false,circlemarker:false
  },
  edit:{featureGroup:new L.FeatureGroup([include,exclude])}
});
map.addControl(drawControl);

var exclusionMode=false;
function modeText(){document.getElementById("modeInclude").textContent=exclusionMode?"Switch to Lawn Mode":"Drawing: Lawn (Include)";}

document.getElementById("modeExclude").onclick=()=>{exclusionMode=true;modeText();}
document.getElementById("modeInclude").onclick=()=>{exclusionMode=false;modeText();}

document.getElementById("clearAll").onclick=()=>{
  include.clearLayers();exclude.clearLayers();updateArea();
};

map.on(L.Draw.Event.CREATED,function(e){
  var layer=e.layer;
  if(exclusionMode){
    layer.setStyle({color:"#c94141",fillOpacity:.25});
    exclude.addLayer(layer);
  } else {
    layer.setStyle({color:"#348E38",fillOpacity:.25});
    include.addLayer(layer);
  }
  try{map.fitBounds(layer.getBounds(),{maxZoom:20});}catch(e){}
  updateArea();
});
map.on(L.Draw.Event.EDITED,updateArea);
map.on(L.Draw.Event.DELETED,updateArea);

function groupToPoly(g){
  var polys=[];g.eachLayer(l=>{
    var gj=l.toGeoJSON();if(!gj.geometry)return;
    if(gj.geometry.type==="Polygon")polys.push(gj.geometry.coordinates);
    if(gj.geometry.type==="MultiPolygon")polys=polys.concat(gj.geometry.coordinates);
  });
  return polys.length?turf.multiPolygon(polys):null;
}

function updateArea(){
  var i=groupToPoly(include), e=groupToPoly(exclude), sqm=0;
  if(i){
    var geom=i;
    if(e) e.coordinates.forEach(c=>{var d=turf.difference(geom,turf.polygon(c));geom=d||geom;});
    sqm=turf.area(geom);
  }
  var sqft=sqm*10.7639;
  document.getElementById("yardAreaSqft").value=Math.round(sqft);
  document.getElementById("yardAreaSqm").value=Math.round(sqm);
  document.getElementById("areaPill").textContent="Area: "+Math.round(sqft).toLocaleString()+" ft² ("+Math.round(sqm)+" m²)";
}

})();
</script>

</body>
</html>
 